Human Record N Replay - HRNR

It is based on OMNIPLAY@db1792f9947926776f0f7718a7c35cbf91dac6f2 when x-proxy and replay pause were supported.

-----------------------------------------------------------------
Create Ubuntu VM
-----------------------------------------------------------------
Download 12.04.2 LTS Ubuntu Linux 32-bit distribution for i386 processor:
  
  http://old-releases.ubuntu.com/releases/12.04.2/ubuntu-12.04.2-desktop-i386.iso

On Intel CPU PC, use VMWare Workstation Player to create a VM with 40G disk space, 4G memory, Bridged Network(replicate physical network connection state)

Login into VM and install ssh server, it will start ssh server after installation:

  sudo apt-get install openssh-server

Find out VM’s IP address:

  ifconfig

-----------------------------------------------------------------
Build omniplay modified linux kernel
-----------------------------------------------------------------
From your PC, ssh to VM:

  ssh username@ip-addr

Install git:

  sudo apt-get install git

Under user’s home directory, check out code from github:

  git clone https://github.com/alanfl/hrnr.git

Setup env variables:

  cd ~/hrnr/scripts
  sudo ./setup.sh
  source ~/.omniplay_setup

Install libraries:

  sudo apt-get install libncurses5-dev libncursesw5-dev

Setup kernel config for build:

  cd ~/hrnr/linux-lts-quantal-3.5.0
  make menuconfig (make sure terminal window size is at least 19x80)
  Press ESC, ESC (quickly) and save the .config file
  Update .config file, “CONFIG_RTS5139=m” to “CONFIG_RTS5139=n”

Build linux kernel:

  sudo ./compile (be patient, may last 2 hours, rerun if failed)
  sudo make modules_install
  sudo make install
  sudo make headers_install INSTALL_HDR_PATH=$OMNIPLAY_DIR/test/replay_headers

Add the following to ~/.profile file:

  export OMNIPLAY_DIR=~/hrnr
  cd $OMNIPLAY_DIR

Note the original linux version then reboot with new kernel:

  uname -r (3.5.0-23-generic)
  reboot

Note new linux kernel version:

  uname -r (3.5.7.13)
  
-----------------------------------------------------------------
Build modified glibc
-----------------------------------------------------------------

Dependencies:

  sudo apt-get install gawk texinfo autoconf gettext

One-time configure:

  cd $OMNIPLAY_DIR/eglibc-2.15/
  mkdir build
  mkdir prefix
  cd build
  LD_LIBRARY_PATH="" ../configure -prefix=$OMNIPLAY_DIR/eglibc-2.15/prefix --disable-profile --enable-add-on --without-gd --without-selinux --without-cvs --enable-kernel=3.2.0
  sudo mkdir /var/db
  sudo chown $USER /var/db
  mkdir ../prefix/etc/
  touch ../prefix/etc/ld.so.conf

To build/install:

  cd $OMNIPLAY_DIR/eglibc-2.15/build
  LD_LIBRARY_PATH="" make
  LD_LIBRARY_PATH="" make install

Also, run some misc fixups (once):

  LD_LIBRARY_PATH="" cd $OMNIPLAY_DIR/eglibc-2.15/prefix/lib
  LD_LIBRARY_PATH="" ln -s /usr/lib/locale

-----------------------------------------------------------------
Building test tools
-----------------------------------------------------------------

To build the tools (no installation, depends on the headers_install when building kernel)
  sudo apt-get install g++
  cd $OMNIPLAY_DIR/test/dev
  make
  cd ..
  make

Add the following to ~/.profile file:

  export LIBPATH=/lib/i386-linux-gnu:/usr/lib/i386-linux-gnu:/usr/local/lib:/usr/lib:/lib
  sudo -E $OMNIPLAY_DIR/scripts/insert_spec.sh (ONLY add this line at this point)
  
-----------------------------------------------------------------
Validate the build
-----------------------------------------------------------------

Reconnect all ssh clients.

Record userspace and kernel space non-deterministics:
  From one terminal window
  cd $OMNIPLAY_DIR/test
  ./xreset.sh
  ./xrun.sh “/bin/nano hello.txt” (type something then exit)
  Output should be: Record log save to: /replay_logdb/rec-1

Replay previous recorded (it will NOT really rerun the program):
  Open another terminal (must be a different terminal window)
  cd $OMNIPLAY_DIR/test
  ./xrerun.sh 1
  Output should be: Goodby! Cruel lmap. This replay is over.
